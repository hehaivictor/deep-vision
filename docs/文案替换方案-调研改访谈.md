# DeepVision 文案替换方案：调研 → 访谈

> 目标：将产品中的"调研"相关文案统一替换，拓宽产品定位

## 改动概览

本次改动包含两部分：

1. **文案替换**：将"调研"统一替换为"访谈"
2. **功能合并**：将"参考文档"和"已有调研成果"合并为"参考资料"

---

## 一、替换原则

1. **不一刀切**：根据语境选择合适的替换词
2. **简化优先**：去掉冗余定语（如"需求"），让产品面更宽
3. **功能合并**：将同质化的"参考文档"和"已有调研成果"合并为"参考资料"

---

## 二、替换规则汇总

| 匹配模式 | 替换为 | 说明 |
|----------|--------|------|
| `调研成果` | `参考资料` | 语义更准确，指用户上传的已有文档 |
| `需求调研` | `访谈` | 简化表达，拓宽产品定位 |
| `智能需求调研助手` | `智能访谈助手` | 产品名简化 |
| `智能需求调研` | `智能访谈` | 产品描述简化 |
| 其余 `调研` | `访谈` | 直接替换 |

---

## 三、功能合并方案：参考文档 + 已有调研成果 → 参考资料

### 3.1 合并背景

当前存在两个同质化功能：

| 对比项 | reference_docs（参考文档） | research_docs（已有调研成果） |
|--------|---------------------------|------------------------------|
| 数据结构 | `{name, content, summary}` | `{name, content, summary}` |
| 上传方式 | 完全相同 | 完全相同 |
| 删除方式 | 完全相同 | 完全相同 |
| AI 处理 | 拼入 prompt 作为上下文 | 拼入 prompt 作为上下文 |
| UI 位置 | 左侧边栏 | 左侧边栏（下方） |

**问题**：
- 用户认知负担：需要区分"参考文档"和"已有调研成果"
- 代码冗余：两套几乎相同的 CRUD 逻辑
- AI 无差别处理：两类文档在 prompt 中的处理方式完全一致

### 3.2 合并后的数据结构

**字段名**：`reference_materials`（参考资料）

```javascript
reference_materials: [
  {
    name: "竞品分析.pdf",
    type: ".pdf",
    content: "...",
    summary: "...",
    source: "upload",           // 用户上传
    uploaded_at: "2026-02-02"
  },
  {
    name: "访谈记录-2026-02-02.md",
    type: ".md",
    content: "...",
    source: "auto",             // 系统自动生成（重新访谈时）
    uploaded_at: "2026-02-02"
  }
]
```

**source 字段取值**：
- `upload`：用户手动上传的文档
- `auto`：系统自动生成的访谈记录（重新访谈时产生）

### 3.3 合并后的 UI 设计

**单一入口，统一展示**：

```
┌─────────────────────────────────────────┐
│ 📎 参考资料                              │
│ 上传已有的文档供 AI 参考                  │
├─────────────────────────────────────────┤
│ [+ 上传文档]                             │
│                                         │
│ 📄 竞品分析.pdf                    [×]  │  ← 用户上传
│ 📄 需求文档.docx                   [×]  │  ← 用户上传
│ 🔄 访谈记录-2026-02-02.md          [×]  │  ← 自动生成
│ 🔄 访谈记录-2026-01-15.md          [×]  │  ← 自动生成
└─────────────────────────────────────────┘
```

**视觉区分**：
- `📄` 用户上传的文档
- `🔄` 系统自动生成的访谈记录

### 3.4 重新访谈流程（合并后）

```
用户点击"重新访谈"
        ↓
确认对话框：当前访谈内容将被保存为历史记录
        ↓
将当前 interview_log 整理成 markdown
        ↓
添加到 reference_materials，标记 source: "auto"
        ↓
重置 interview_log 和 dimensions
        ↓
新一轮访谈开始（可参考上轮记录）
```

### 3.5 API 变更

| 原 API | 合并后 API | 说明 |
|--------|-----------|------|
| `POST /api/sessions/<id>/reference-doc` | `POST /api/sessions/<id>/reference-material` | 上传参考资料 |
| `DELETE /api/sessions/<id>/reference-doc` | `DELETE /api/sessions/<id>/reference-material` | 删除参考资料 |
| `POST /api/sessions/<id>/research-doc` | 删除 | 合并到上方 |
| `DELETE /api/sessions/<id>/research-doc` | 删除 | 合并到上方 |
| `POST /api/sessions/<id>/restart-research` | `POST /api/sessions/<id>/restart-interview` | 重新访谈（写入 reference_materials） |

### 3.6 数据迁移

对于已有会话数据，需要迁移：

```python
def migrate_session(session):
    """将旧的 reference_docs + research_docs 迁移到 reference_materials"""
    materials = []

    # 迁移参考文档
    for doc in session.get("reference_docs", []):
        doc["source"] = "upload"
        materials.append(doc)

    # 迁移调研成果
    for doc in session.get("research_docs", []):
        doc["source"] = "auto"
        materials.append(doc)

    session["reference_materials"] = materials

    # 删除旧字段
    session.pop("reference_docs", None)
    session.pop("research_docs", None)

    return session
```

---

## 四、具体文案对照表

### 4.1 页面标题与导航

| 文件 | 原文案 | 替换后 |
|------|--------|--------|
| `index.html:6` | Deep Vision 深瞳 - 智能需求调研助手 | Deep Vision 深瞳 - 智能访谈助手 |
| `index.html:453` | 调研报告 | 访谈报告 |

### 4.2 会话管理视图

| 文件 | 原文案 | 替换后 |
|------|--------|--------|
| `index.html:504` | 调研会话 | 访谈会话 |
| `index.html:505` | 管理您的需求调研会话 | 管理您的访谈会话 |
| `index.html:512` | 新建调研 | 新建访谈 |
| `index.html:587` | 暂无调研会话 | 暂无访谈会话 |
| `index.html:591` | 点击"新建调研"开始您的第一次智能需求调研 | 点击"新建访谈"开始您的第一次智能访谈 |

### 4.3 访谈进行中界面

| 文件 | 原文案 | 替换后 |
|------|--------|--------|
| `index.html:612` | 调研主题 | 访谈主题 |
| `index.html:1181` | 您已经完成了全部 4 个维度的调研访谈 | 您已经完成了全部 4 个维度的访谈 |
| `index.html:1368` | 重新调研 | 重新访谈 |

### 4.4 参考资料区域（合并后）

原来有两个区域（参考文档 + 已有调研成果），合并为一个：

| 文件 | 原文案 | 替换后 |
|------|--------|--------|
| `index.html` | 参考文档 / 已有调研成果 | 参考资料 |
| `index.html` | 上传参考文档 / 上传调研成果 | 上传文档 |
| `index.html` | 暂无参考文档 / 暂无调研成果 | 暂无参考资料 |
| `index.html` | x 个文档已上传 / x 个调研成果已上传 | x 份参考资料 |

### 4.5 报告视图

| 文件 | 原文案 | 替换后 |
|------|--------|--------|
| `index.html:1382` | 调研报告 | 访谈报告 |
| `index.html:1383` | 查看和管理已生成的调研报告 | 查看和管理已生成的访谈报告 |
| `index.html:1430` | 暂无调研报告 | 暂无访谈报告 |
| `index.html:1431` | 完成调研后会在这里显示生成的报告 | 完成访谈后会在这里显示生成的报告 |

### 4.6 新建会话弹窗

| 文件 | 原文案 | 替换后 |
|------|--------|--------|
| `index.html:1533` | 新建调研会话 | 新建访谈会话 |
| `index.html:1542` | 调研主题 * | 访谈主题 * |
| `index.html:1545` | 例如：CRM系统需求调研 | 例如：CRM系统需求访谈 |
| `index.html:1548` | 简洁描述本次调研的主题或项目名称 | 简洁描述本次访谈的主题或项目名称 |
| `index.html:1605` | 开始调研 | 开始访谈 |

### 4.7 重新访谈确认弹窗

| 文件 | 原文案 | 替换后 |
|------|--------|--------|
| `index.html:1722` | 确认重新调研 | 确认重新访谈 |
| `index.html:1723` | 当前调研成果将被保存为历史记录，并开始新一轮调研。确定继续吗？ | 当前访谈内容将被保存为参考资料，并开始新一轮访谈。确定继续吗？ |
| `index.html:1731` | 确认重新调研 | 确认重新访谈 |

### 4.8 Toast 提示消息（app.js）

| 文件 | 原文案 | 替换后 |
|------|--------|--------|
| `app.js:392` | 调研主题不能超过xx个字符 | 访谈主题不能超过xx个字符 |
| `app.js:399` | 调研描述不能超过xx个字符 | 访谈描述不能超过xx个字符 |
| `app.js:638` | 调研成果 xxx 上传成功 | 参考资料 xxx 上传成功 |
| `app.js:672` | 调研成果 xxx 已删除 | 参考资料 xxx 已删除 |
| `app.js:678` | 删除调研成果失败 | 删除参考资料失败 |
| `app.js:1014` | 所有维度调研完成！ | 所有维度访谈完成！ |
| `app.js:1240` | 已保存当前调研成果，开始新一轮调研 | 已保存当前访谈内容，开始新一轮访谈 |
| `app.js:1253` | 重新调研失败 | 重新访谈失败 |

### 4.9 配置文件（site-config.js）

| 文件 | 原文案 | 替换后 |
|------|--------|--------|
| `site-config.js:110` | 越坦诚的回答越有助于深入调研 | 越坦诚的回答越有助于深入访谈 |

### 4.10 后端模板与 AI 提示词（server.py）

| 文件 | 原文案 | 替换后 |
|------|--------|--------|
| `server.py:2950` | 未命名调研 | 未命名访谈 |
| `server.py:2356` | 专业的需求调研访谈师，正在进行…的需求调研 | 专业的访谈师，正在进行…的访谈 |
| `server.py:2417` | 生成一份专业的需求调研报告 | 生成一份专业的访谈报告 |
| `server.py:4135` | {topic} 需求调研报告 | {topic} 访谈报告 |
| `server.py:4137` | 调研日期 | 访谈日期 |
| `server.py:4137` | 调研概述 | 访谈概述 |
| `server.py:4164` | Deep Vision 深瞳-智能需求调研助手生成 | Deep Vision 深瞳-智能访谈助手生成 |

---

## 五、涉及文件清单

### 5.1 文案替换

| 文件路径 | 替换数量（约） |
|----------|----------------|
| `web/index.html` | 30+ |
| `web/app.js` | 10+ |
| `web/site-config.js` | 2 |
| `web/server.py` | 20+ |
| `SKILL.md` | 15+ |
| `README.md` | 10+ |
| `web/README.md` | 10+ |
| `scripts/report_generator.py` | 15+ |
| `scripts/session_manager.py` | 10+ |

### 5.2 功能合并（代码重构）

| 文件路径 | 改动内容 |
|----------|----------|
| `web/index.html` | 合并两个文档上传区域为一个 |
| `web/app.js` | 合并文档上传/删除逻辑 |
| `web/server.py` | 合并 API 端点，修改数据结构 |
| `web/server.py` | 修改 restart-research → restart-interview |
| `web/server.py` | 添加数据迁移逻辑 |

---

## 六、执行计划

### 阶段 1：功能合并（代码重构）

1. **后端改造**
   - [ ] 新增 `reference_materials` 字段支持
   - [ ] 合并 reference-doc 和 research-doc API
   - [ ] 修改 restart-research → restart-interview
   - [ ] 添加数据迁移逻辑（兼容旧会话）

2. **前端改造**
   - [ ] 合并两个文档上传区域 UI
   - [ ] 添加 source 图标区分（📄 vs 🔄）
   - [ ] 更新 app.js 中的相关逻辑

### 阶段 2：文案替换

1. **前端文案**
   - [ ] index.html 文案替换
   - [ ] app.js Toast 消息替换
   - [ ] site-config.js 小技巧替换

2. **后端文案**
   - [ ] server.py AI 提示词替换
   - [ ] server.py 报告模板替换

3. **文档更新**
   - [ ] SKILL.md
   - [ ] README.md
   - [ ] web/README.md

### 阶段 3：测试验证

- [ ] 新建访谈流程正常
- [ ] 参考资料上传/删除正常
- [ ] 重新访谈后，访谈记录正确保存为参考资料
- [ ] 旧会话数据迁移正常
- [ ] 生成的报告标题和署名正确
- [ ] 无遗漏的"调研"字样

---

## 七、回滚方案

如需回滚，执行：

```bash
git checkout -- web/index.html web/app.js web/site-config.js web/server.py
```

或从 Git 历史恢复特定文件。

---

*文档生成时间：2026-02-02*
*最后更新：2026-02-02（新增功能合并方案）*
